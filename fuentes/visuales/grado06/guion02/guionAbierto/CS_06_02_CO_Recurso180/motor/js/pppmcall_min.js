/* VERSION : 14.12.16.1 */ 
this.createjs=this.createjs||{};(function(){var b=function(h,g,f){this.initialize(h,g,f)};var e=b.prototype=new createjs.DisplayObject();var c=function(g,f){this.text=g;this.style=f};var d=function(){this.items=new Array();this.align="left";this.topMargin=0;this.bottomMargin=0;this.lineSepExtra=0;this.paraWidth=0};createjs.HTMLTextRun=c;createjs.HTMLTextPara=d;var a=(createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"));if(a.getContext){b._workingContext=a.getContext("2d");a.width=a.height=1}e.text="";e.font=null;e.color=null;e.textAlign="left";e.textBaseline="top";e.maxWidth=null;e.outline=0;e.lineHeight=0;e.lineWidth=null;e.borderColor=null;e.backgroundColor=null;e.leftMargin=0;e.rightMargin=0;e.topMargin=0;e.bottomMargin=0;e.yPatch=-1;e.calcMaxWidth=0;e.DisplayObject_initialize=e.initialize;e.initialize=function(h,g,f){this.DisplayObject_initialize();this.text=h;this.font=g;this.color=f;this.calcMaxWidth=this._calcText(null,{}).width};e.isVisible=function(){var f=this.cacheCanvas||(this.text!=null);return !!(this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0&&f)};e.DisplayObject_draw=e.draw;e.draw=function(f,i){if(this.DisplayObject_draw(f,i)){return true}var g;if(this.borderColor!=null||this.backgroundColor!=null){var h=this.getBounds();if(this.backgroundColor!=null){g=this.backgroundColor;f.fillStyle=g;f.rect(h.x+0.5,h.y+0.5,h.width,h.height);f.fill()}if(this.borderColor!=null){g=this.borderColor;f.strokeStyle=g;f.rect(h.x+0.5,h.y+0.5,h.width,h.height);f.stroke()}}g=this.color||"#000";if(this.outline){f.strokeStyle=g;f.lineWidth=this.outline*1}else{f.fillStyle=g}this._drawText(this._prepContext(f));return true};e.getMeasuredWidth=function(){return this._drawText(null,{}).width};e.getMeasuredHeight=function(){return this._drawText(null,{}).height};e.getMeasuredLineHeight=function(f){return f.measureText("M").width*1.3};e.DisplayObject_getBounds=e.getBounds;e.getBounds=function(){var f=this.DisplayObject_getBounds();if(f){return f}if(this.text==null){return null}var g=this._drawText(null,{});return this._rectangle.initialize(0,0,g.width,g.height)};e.clone=function(){var f=new b(this.text,this.font,this.color);this.cloneProps(f);return f};e.toString=function(){return"[HTMLText (text="+(this.text.length>20?this.text.substr(0,17)+"...":this.text)+")]"};e.DisplayObject_cloneProps=e.cloneProps;e.cloneProps=function(f){this.DisplayObject_cloneProps(f);f.maxWidth=this.maxWidth;f.outline=this.outline;f.lineHeight=this.lineHeight;f.lineWidth=this.lineWidth;f.borderColor=this.borderColor;f.backgroundColor=this.backgroundColor;f.leftMargin=this.leftMargin;f.rightMargin=this.rightMargin;f.topMargin=this.topMargin;f.bottomMargin=this.bottomMargin;f.yPatch=this.yPatch};e._prepContext=function(f){f.font=this.font;f.textAlign="left";f.textBaseline="top";return f};e._calcText=function(){var u=this._prepContext(b._workingContext);if(this.yPatch==-1){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){this.yPatch=0}else{this.yPatch=u.measureText("M").width*0.25}}var n=0;if(this.lineWidth>0){n=this.lineWidth-this.leftMargin-this.rightMargin}var t=0;var g="";var r=this.leftMargin;var q=this.topMargin;for(var m=0;m<this.text.length;m++){var f=this.text[m];var l=0;var s=this.lineHeight||Math.ceil(this.getMeasuredLineHeight(u));r=this.leftMargin;q+=f.topMargin;for(var k=0;k<f.items.length;k++){var v=f.items[k];if(n>0){}else{var p=v.style+" "+this.font;if(g!=p){u.font=p;g=p}r+=Math.ceil(u.measureText(v.text).width);l=r}}q+=s;q+=f.bottomMargin;l+=this.rightMargin;f.paraWidth=l;if(t<l){t=l}}q+=this.bottomMargin;var h={};h.count=this.text.length;h.width=t;h.height=q;return h};e._drawText=function(w,h){var p=!!w;var k=true;if(!p){w=this._prepContext(b._workingContext);k=false}if(this.yPatch==-1){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){this.yPatch=0}else{this.yPatch=w.measureText("M").width*0.25}}var q=0;if(this.lineWidth>0){q=this.lineWidth-this.leftMargin-this.rightMargin}var v=0;var g="";var t=this.leftMargin;var s=this.topMargin;for(var n=0;n<this.text.length;n++){var f=this.text[n];var m=0;var u=this.lineHeight||Math.ceil(this.getMeasuredLineHeight(w));t=this.leftMargin;s+=f.topMargin;if(f.align=="center"){t=this.leftMargin+(this.calcMaxWidth-f.paraWidth)/2}else{if(f.align=="right"){t=this.leftMargin+this.calcMaxWidth-f.paraWidth}}for(var l=0;l<f.items.length;l++){var z=f.items[l];if(q>0){}else{var r=z.style+" "+this.font;if(g!=r){w.font=r;g=r}if(k){if(this.outline){w.strokeText(z.text,0,s-this.yPatch,65535)}else{w.fillText(z.text,t,s-this.yPatch,65535)}}t+=Math.ceil(w.measureText(z.text).width);m=t}}s+=u;s+=f.bottomMargin;m+=this.rightMargin;if(v<m){v=m}}s+=this.bottomMargin;if(h){h.count=this.text.length;h.width=v;h.height=s}return h};b.formatPlainText=function(o){var l=new Array();var p=String(o).split(/(?:\r\n|\r|\n|<br[^>]*>)/);var f;var g;for(var k=0;k<p.length;k++){var m=p[k];f=new createjs.HTMLTextPara();var n=m.split(/(\s)/);for(var h=0;h<n.length;h++){g=new createjs.HTMLTextRun(n[h],"");f.items.push(g)}l.push(f)}return l};createjs.HTMLText=b}());var TouchComp={eventPointerDown:"",eventPointerUp:"",eventPointerMove:"",isTouchOperation:false,isTouchDevice:function(){try{document.createEvent("TouchEvent");return"ontouchstart" in window||"onmsgesturechange" in window}catch(a){return false}},init:function(){if(this.isTouchDevice()){this.eventPointerDown="touchstart";this.eventPointerUp="touchend";this.eventPointerMove="touchmove"}else{this.eventPointerDown="mousedown";this.eventPointerUp="mouseup";this.eventPointerMove="mousemove"}},fixTouch:function(e){var c=window.pageXOffset,b=window.pageYOffset,a=e.clientX,d=e.clientY;if(e.pageY===0&&Math.floor(d)>Math.floor(e.pageY)||e.pageX===0&&Math.floor(a)>Math.floor(e.pageX)){a=a-c;d=d-b}else{if(d<(e.pageY-b)||a<(e.pageX-c)){a=e.pageX-c;d=e.pageY-b}}return{x:a,y:d}},getEventScreenCoords:function(b){if(this.isTouchDevice()){var c=b.changedTouches[0];var a=new Object();a.x=c.pageX;a.y=c.pageY;return a}else{var a=new Object();a.x=b.screenX;a.y=b.screenY;return a}}};var XDOM={newXML:function(a){if(jQuery.browser.msie){var c=new ActiveXObject("Microsoft.XMLDOM");if(a!=""&&a!=null&&a!=undefined){var b="<"+a+"></"+a+">";c.loadXML(b)}return c}else{if(document.implementation.createDocument){return document.implementation.createDocument("",a,null)}}return null},newXMLFromString:function(b){var c;var a;if(jQuery.browser.msie){a=new ActiveXObject("Microsoft.XMLDOM");a.async=false;a.loadXML(b)}else{c=new DOMParser();a=c.parseFromString(b,"text/xml")}return a},newXMLFromURL:function(a,c,b){$.ajax({type:"GET",url:a,async:false,dataType:($.browser.msie)?"text":"xml",success:function(e){var d;if(typeof e==="string"){d=new ActiveXObject("Microsoft.XMLDOM");d.async=false;d.loadXML(e)}else{d=e}if(c!=null||c!=undefined||c!=""){c(d)}},error:function(d,f,e){if(b!=null||b!=undefined||b!=""){b(f,e)}}})},cloneXML:function(e){var d;if(typeof(ActiveXObject)!="undefined"){d=new ActiveXObject("Microsoft.XMLDOM");var a=e.documentElement;var c=a.cloneNode(true);d.appendChild(c)}else{d=e.implementation.createDocument(e.namespaceURI,null,null);var b=d.importNode(e.documentElement,true);d.appendChild(b)}return(d)},mergeXML:function(g,f,d,e){var b=XDOM.cloneXML(g);var a=$(b);var c=$(f);c.children(d).children().each(function(){var k=this.nodeName;var i=a.children(d).children(k)[0];var h;if(i){h=i.nodeName}else{h=""}if(e==null||e==undefined){e=2}var j=false;switch(e){case 1:if(k==h){j=true}break;case 3:if(k!=h){j=true}break;case 4:break;case 2:default:j=true}if(j){XDOM.removeNode(i);XDOM.appendNode(a.children(d)[0],this)}});return b},XMLToString:function(c){var b;if(window.ActiveXObject){b=c.xml}else{var a=new XMLSerializer();b=a.serializeToString(c)}return b},nodeByPath:function(g,l){var d=l.split(".");var f=$(g).children("motor");var e;var c=f[0];for(e=0;e<d.length;e++){var b=d[e];if(e==(d.length-1)){var j;if(b.indexOf("@")!==-1){if(c==null){return null}return c}else{if(b.indexOf("[")>0){var h=b.substring(b.indexOf("[")+1,b.indexOf["]"]);h=parseInt(h);var k=b.substring(0,b.indexOf("["));j=$(c).children(k);if(j==null||j.length==0||h>(j.length-1)){return null}return j[h]}else{j=$(c).children(b);if(j==null||j.length==0){return null}return j[0]}}}else{var a;if(b.indexOf("[")>0){var h=b.substring(b.indexOf("[")+1,b.indexOf["]"]);h=parseInt(h);var k=b.substring(0,b.indexOf("["));a=$(c).children(k);if(a==null||a.length==0||h>(a.length-1)){return null}c=a[h]}else{a=$(c).children(b);if(a==null||a.length==0){return null}c=a[0]}}}return null},valueOfNode:function(g,m){var d=m.split(".");var f=$(g).children();var e;var c=f[0];for(e=0;e<d.length;e++){var b=d[e];if(e==(d.length-1)){var k;if(b.indexOf("@")!==-1){if(c==null){return""}var j=b.substring(1);return $(c).attr(j)}else{if(b.indexOf("[")>0){var h=b.substring(b.indexOf("[")+1,b.indexOf["]"]);h=parseInt(h);var l=b.substring(0,b.indexOf("["));k=$(c).children(l);if(k==null||k.length==0||h>(k.length-1)){return""}return $(k[h]).text()}else{k=$(c).children(b);if(k==null||k.length==0){return""}return $(k[0]).text()}}}else{var a;if(b.indexOf("[")>0){var h=b.substring(b.indexOf("[")+1,b.indexOf["]"]);h=parseInt(h);var l=b.substring(0,b.indexOf("["));a=$(c).children(l);if(a==null||a.length==0||h>(a.length-1)){return""}c=a[h]}else{a=$(c).children(b);if(a==null||a.length==0){return""}c=a[0]}}}return""},valueOfXMLNode:function(a){return $(a).text()},newNode:function(c){var b=XDOM.newXML(c);var a=$(b).children(c)[0];return a},removeNode:function(a){if(a==null||a==undefined){return}if(jQuery.browser.msie==true){a.parentNode.removeChild(a)}else{$(a).remove()}},appendNode:function(c,a){var b=a.cloneNode(true);c.appendChild(b)},getTextNodes:function(a){return $(a).contents().filter(function(){return(((this.nodeName=="#text"&&this.nodeType=="3")||this.nodeType=="4")&&($.trim(this.nodeValue.replace("\n",""))!==""))})},setNodeValue:function(b,c){var a=XDOM.getTextNodes(b);if(a.get(0)){a.get(0).nodeValue=c}else{b.textContent=c}},setNewNodeCDATAValue:function(b,c,d){var a=b.createCDATASection(d);c.appendChild(a);return a}};var XAUDIO={_tagIdPrefix:"ssi_ae",_nextIndex:0,audioGetId:function(a){return XAUDIO._tagIdPrefix+"_audio_"+a},audioCreateTag:function(b){var a=this._nextIndex;this._nextIndex++;var d=XAUDIO.audioGetId(a);var c="<audio id='"+d+"' preload='auto'>		<source src='"+encodeURI(b)+"' type='audio/mpeg'/></audio>";$(document.body).append(c);document.getElementById(d).addEventListener("playing",function(){$(this).attr("hasBeenPlayed","1")},false);return a},audioStart:function(a,c){var d=XAUDIO.audioGetId(a);var b=document.getElementById(d);if(!b){return}if($(b).attr("hasBeenPlayed")=="1"){b.currentTime=0}b.play();b.muted=c||false},audioStop:function(a){var c=XAUDIO.audioGetId(a);var b=document.getElementById(c);if(!b){return}if(!b.paused){b.pause()}},audioPlay:function(a,c){var d=XAUDIO.audioGetId(a);var b=document.getElementById(d);if(!b){return}if(b.paused){b.play();b.muted=c||false}},audioPause:function(a){var c=XAUDIO.audioGetId(a);var b=document.getElementById(c);if(!b){return}if(!b.paused){b.pause()}},audioUpdateMute:function(a,c){var d=XAUDIO.audioGetId(a);var b=document.getElementById(d);if(!b){return}b.muted=c||false}};function ExtendedShape(){this.embedShape=function(c,g){var d=new createjs.Container();var i;var a=c.width,f=c.height;i=new createjs.Shape();i.graphics.beginFill("#99BBFF");i.graphics.drawRect(0,0,a+2*g,f+2*g);i.graphics.endFill();i.alpha=0.01;var e=new createjs.Container();var b=new createjs.Shape();b.graphics.beginFill("#EEAAFF");b.graphics.drawRect(0,0,a,f);b.graphics.endFill();b.alpha=0.01;d.addChild(i);d.addChild(e);e.addChild(b);e.addChild(c);e.x=e.y=g;d.regX=d.regY=g;d.visible=true;d.width=c.width;d.height=c.height;return d};this.createTriangle=function(b,j,a,d,e){if(a==undefined){a=true}if(d==undefined){d=false}if(e==undefined){e="#000000"}var c;if(a==true){c=0}else{c=-90}var i=new createjs.Container();var f=new createjs.Shape();f.graphics.beginFill("#FFAAFF");f.graphics.drawRect(0,0,b,j);f.graphics.endFill();f.alpha=0.01;var g=new createjs.Shape();var h=b/2;if(d){c+=180;g.graphics.beginFill(e).drawPolyStar(b/2,j/2,h,3,0,c)}else{g.graphics.beginFill(e).drawPolyStar(b/2,j/2,h,3,0,c)}g.graphics.endFill();g.visible=true;i.width=b;i.height=j;i.addChild(f);i.addChild(g);return i};this.addRoundedBorder=function(e,d,c,b,h){if(b==undefined){b="#000000"}if(h==undefined){h="#FFFFFF"}var f=new createjs.Container();var g=new createjs.Shape();g.graphics.beginFill(h);g.graphics.drawCircle(0,0,e.width/2+c);g.graphics.endFill();var a=new createjs.Shape();a.graphics.beginFill(b).arc(0,0,e.width/2+d+c,0,Math.PI*2,true).arc(0,0,e.width/2+c,Math.PI*2,0,false);a.x=a.y=e.width/2;g.x=g.y=e.width/2;f.addChild(a);f.addChild(g);f.addChild(e);f.width=e.width;f.height=e.height;return f};this.createRoundedCornersRect_=function(l,j,f,b,m,d,i){var g=4;if(d==undefined){d="#000000"}if(i==undefined){i="#FFFFFF"}var k=new createjs.Container();var e=new createjs.Shape();e.graphics.beginFill(i);e.graphics.drawRoundRect(0,0,j,f,g);e.graphics.endFill();var c=new createjs.Shape();c.graphics.beginFill(d);c.graphics.drawRoundRect(0,0,j+b*2,f+50+b*2,g);k.addChild(c);k.addChild(e);k.addChild(l);e.x=e.y=b;var a=l.getBounds();l.x=j/2-a.width/2;k.width=j+b;k.height=f+b;return k};this.createRoundedCornersRect=function(k,i,e,b,l,c,g){var f=4;if(c==undefined){c="#000000"}if(g==undefined){g="#FFFFFF"}var j=new createjs.Container();var d=new createjs.Shape();d.graphics.beginFill(g);d.graphics.drawRoundRect(0+0.5,0+0.5,i+b*2,e+b*2,f);d.graphics.endFill();d.graphics.beginStroke(c);d.graphics.drawRoundRect(0+0.5,0+0.5,i+b*2,e+b*2,f);d.graphics.endStroke();j.addChild(d);j.addChild(k);d.x=d.y=b;var a=k.getBounds();k.x=i/2-a.width/2+2;k.y=k.y+1;j.width=i+b;j.height=e+b;return j}}function pppMapaConceptual(b,a){if(b==undefined){alert("Hay que passar el ID de un elemento HTML al Mapa Conceptual.");return}this.MC_WIDTH=950;this.MC_HEIGHT=608;this.luzInterGlobal=30;this.anchoMedioHoja=464;this.fontGlobal="Verdana";this.IMAGE_SCALE=0.25;this.lInterlineados=[1+3,2+3,3+3,4+3,5+3,6+3,7+3,8+3,9+3,10+3,11+3,12+3,13+3,14+3,15+3,16+3,17+3,18+3,19+3,20+3,21+3,22+3,23+3,24+3,25+3,26+3,27+3,28+3,29+3,30+3];this.TOP_BORDER=6;this.BUTTON_W=30;this.BUTTON_H=30;this.BUTTON_SEP=2;this.B_SIDE_BORDER=4;this.B_RIGHT_BORDER=30;this.TEXT_BUTTON_W=100;this.FLECHA_DN_W=15;this.FLECHA_DN_H=15;this.FLECHA_UP_W=15;this.FLECHA_UP_H=15;this.FLECHA_AUDIO_W=13;this.FLECHA_AUDIO_H=13;this._debug=a||false;this._mcContainerName=b;this._mcContainer;this._mcCanvas;this.cWidth;this.cHeight;this._isIOS;this._isNativeBrowser;this._initialized;this._actionsReady;this._indexedObjects;this.lObjetos;this.llNiveles;this.qImagenes;this.qDescargas;this._preload;this._manifest;this._MCImages;this._hashImages;this.lPictosAudio;this.lCajasColgadas;this.lCajasMudas;this.lConectoresColgados;this.stage;this.papel;this.supra_papel;this.logo;this.flechaUp;this.flechaDn;this.co_tablero;this.tapaFantasma;this.zoomPapel;this.mouseDownEv;this.mouseUpEv;this.mouseMoveEv;this.antX;this.antY;this.w;this.h;this.scale;this._needPatch;this.shapeFactory;this.botonera;this.bn_MM;this.bn_MC;this.bn_zoom_mas;this.bn_zoom_men;this.bn_mudo;this.bn_reproducir;this.bn_detalle;this.bn_mapa;this.bn_xml;this.bBnMudo;this.bOcultando;this.bReproduciendo;this.initJQuery=function(){var d;var c=navigator.userAgent.toLowerCase();jQuery.browser=new Object();jQuery.browser.msie=/msie|trident/.test(c);d=c.match(/(msie|trident)\s*(?:\/\s*)?(.[^;]*)/);if(d){jQuery.browser.engine=$.trim(d[1]);jQuery.browser.version=parseFloat($.trim(d[2]))}else{jQuery.browser.engine="";jQuery.browser.version=-1}};this.initMapaConceptual=function(c,e){var d=this;d.initJQuery();if(d._initialized==true){return}d._indexedObjects=new Object();d._MCImages=new Object();d._hashImages=new Object();d._mcCanvas=null;d._mcContainer=null;d.zoomPapel=1;d.mouseDownEv=null;d.mouseUpEv=null;d.antX=undefined;d.antY=undefined;d.scale=1;d._needPatch=false;d._isIOS=false;d._isNativeBrowser=false;d._actionsReady=false;if(c==undefined||c==""||c==null){d._sourceURL="."}else{d._sourceURL=c}if(e==undefined||e==""||e==null){d._sourceFile=d._sourceURL+"/data/datos.xml"}else{d._sourceFile=e}d._initialized=true;$(document).ready(function(){d.onDOMContentLoaded(d)})};this.initDisplayMapaC=function(){var e=this;var o=e._mcCanvas.getContext("2d");o.strokeStyle="red";o.fillStyle="#FFFFFF";o.fillRect(0,0,e.MC_WIDTH,e.MC_HEIGHT);e.lPictosAudio=new Array();e.stage=new createjs.Stage(e._mcContainerName);var k=new createjs.Shape();e.papel=new createjs.Container();k.graphics.beginFill("#FFFFFF");k.graphics.drawRect(0,0,e.MC_WIDTH,e.MC_HEIGHT);k.graphics.endFill();k.x=0;k.y=0;e.papel.addChild(k);e.stage.addChild(e.papel);e.logo=new createjs.Bitmap(e._MCImages["logo.png"]);var i=e.logo;i.scaleX=i.scaleY=0.5;i.x=i.y=e.TOP_BORDER;e.shapeFactory=new ExtendedShape();e.flechaUp=e.shapeFactory.embedShape(e.shapeFactory.createTriangle(e.FLECHA_UP_W,e.FLECHA_UP_H,false,false,"#444CA1"),5);e.flechaDn=e.shapeFactory.embedShape(e.shapeFactory.createTriangle(e.FLECHA_DN_W,e.FLECHA_DN_H,false,true,"#444CA1"),5);e.supra_papel=new createjs.Container();e.botonera=new createjs.Container();var f=e.supra_papel;var h=new createjs.Shape();e.botonera.addChild(h);e.stage.addChild(f);f.addChild(e.botonera);h.graphics.beginFill("#FFFFFF");var m=e.BUTTON_W*7+e.BUTTON_SEP*4+e.B_SIDE_BORDER*2+11;h.graphics.drawRect(0,0,m,2*2+e.BUTTON_H-4);h.graphics.endFill();f.x=0;f.y=0;e.botonera.x=e.MC_WIDTH-m-e.B_RIGHT_BORDER;e.botonera.y=e.TOP_BORDER;h.x=0;h.y=0;h.alpha=0;e.botonera.addEventListener("click",function(p){p.stopImmediatePropagation()});e.tapaFantasma=new createjs.Shape();e.tapaFantasma.graphics.beginFill("#FFFFFF");e.tapaFantasma.graphics.drawRect(0,2*3+e.BUTTON_H,e.MC_WIDTH,e.MC_HEIGHT-(2*2+e.BUTTON_H));e.tapaFantasma.graphics.endFill();e.tapaFantasma.alpha=0.01;e.tapaFantasma.addEventListener("click",function(p){p.stopImmediatePropagation()});var j=0;var c=0;e.bn_reproducir=new createjs.Container();e.bn_reproducir.ocultar=new createjs.Bitmap(e._MCImages["soundon.png"]);e.bn_reproducir.mostrar=new createjs.Bitmap(e._MCImages["soundoff.png"]);e.bn_reproducir.visible=false;e.bn_reproducir.mostrar.visible=true;e.bn_reproducir.ocultar.visible=true;e.bn_reproducir.addChild(e.bn_reproducir.mostrar);e.bn_reproducir.addChild(e.bn_reproducir.ocultar);e.botonera.addChild(e.bn_reproducir);c+=e.BUTTON_SEP;e.bn_reproducir.x=c;e.bn_reproducir.y=1;e.bn_reproducir.addEventListener("click",function(p){e.onClic_Reproducir(p,e)});e.bn_reproducir.cursor="pointer";j++;e.bn_mudo=new createjs.Container();e.bn_mudo.ocultar=new createjs.Bitmap(e._MCImages["ttachado.png"]);e.bn_mudo.mostrar=new createjs.Bitmap(e._MCImages["tnormal.png"]);e.bn_mudo.visible=false;e.bn_mudo.mostrar.visible=false;e.bn_mudo.ocultar.visible=true;e.bn_mudo.addChild(e.bn_mudo.mostrar);e.bn_mudo.addChild(e.bn_mudo.ocultar);e.botonera.addChild(e.bn_mudo);c+=e.BUTTON_SEP+e.BUTTON_W;e.bn_mudo.x=c;e.bn_mudo.y=1;e.bn_mudo.addEventListener("click",function(p){e.onClic_Mudo(p,e)});e.bn_mudo.cursor="pointer";j++;e.bn_zoom_mas=new createjs.Container();e.bn_zoom_mas.ocultar=new createjs.Bitmap(e._MCImages["botomes.png"]);e.bn_zoom_mas.mostrar=new createjs.Bitmap(e._MCImages["botomes.png"]);e.bn_zoom_mas.visible=true;e.bn_zoom_mas.mostrar.visible=true;e.bn_zoom_mas.ocultar.visible=true;e.bn_zoom_mas.addChild(e.bn_zoom_mas.mostrar);e.bn_zoom_mas.addChild(e.bn_zoom_mas.ocultar);e.botonera.addChild(e.bn_zoom_mas);c+=e.BUTTON_SEP+e.BUTTON_W;e.bn_zoom_mas.x=c;e.bn_zoom_mas.y=1;e.bn_zoom_mas.addEventListener("click",function(p){e.onClic_bn_zoom(p,e,"bn_zoom_mas")});e.bn_zoom_mas.cursor="pointer";j++;e.bn_zoom_men=new createjs.Container();e.bn_zoom_men.ocultar=new createjs.Bitmap(e._MCImages["botomenys.png"]);e.bn_zoom_men.mostrar=new createjs.Bitmap(e._MCImages["botomenys.png"]);e.bn_zoom_men.visible=false;e.bn_zoom_men.mostrar.visible=true;e.bn_zoom_men.ocultar.visible=true;e.bn_zoom_men.addChild(e.bn_zoom_men.mostrar);e.bn_zoom_men.addChild(e.bn_zoom_men.ocultar);e.botonera.addChild(e.bn_zoom_men);c+=e.BUTTON_SEP+e.BUTTON_W;e.bn_zoom_men.x=c;e.bn_zoom_men.y=1;e.bn_zoom_men.addEventListener("click",function(p){e.onClic_bn_zoom(p,e,"bn_zoom_men")});e.bn_zoom_men.cursor="pointer";j++;var l=e.formatMCText("ocultar","2222222","left");var g=new createjs.HTMLText(l,"16px "+e.fontGlobal,"#000000");g.topMargin=6;g.leftMargin=3;g.rightMargin=3;g.bottomMargin=2;e.bn_MM=e.shapeFactory.createRoundedCornersRect(g,e.TEXT_BUTTON_W,e.BUTTON_H-7,1,3);e.botonera.addChild(e.bn_MM);e.bn_MM.visible=false;e.bn_MM.mouseChildren=false;e.bn_MM.cursor="pointer";c+=e.BUTTON_SEP+e.BUTTON_W+2;e.bn_MM.x=c;e.bn_MM.y=2;e.bn_MM.addEventListener("click",function(p){e.onClic_bn_MM(p,e)});var l=e.formatMCText("mostrar","2222222","left");g=new createjs.HTMLText(l,"16px "+e.fontGlobal,"#000000");g.topMargin=6;g.leftMargin=3;g.rightMargin=3;g.bottomMargin=2;e.bn_MC=e.shapeFactory.createRoundedCornersRect(g,e.TEXT_BUTTON_W,e.BUTTON_H-7,1,3);e.botonera.addChild(e.bn_MC);e.bn_MC.visible=false;e.bn_MC.mouseChildren=false;e.bn_MC.cursor="pointer";e.bn_MC.x=c;e.bn_MC.y=2;e.bn_MC.addEventListener("click",function(p){e.onClic_bn_MC(p,e)});j++;e.bBnMudo=0;e.co_tablero=new createjs.Container();var d=new createjs.Shape();d.graphics.setStrokeStyle(1);d.graphics.beginStroke("#716230");var n="#FFFFFF";d.graphics.beginFill(n);d.graphics.drawRect(0,0,2*e.anchoMedioHoja,590);d.graphics.endFill();e.co_tablero.addChild(d);e.co_tablero.x=10;e.co_tablero.y=4;e.stage.addChild(e.co_tablero);e.bOcultando=false;e.bReproduciendo=false;e.co_tablero.visible=true};this.loadMCImages=function(){var c=this;c._manifest=new Array();c.prepareMCImageManifest();c.startMCImagePreload()};this.prepareMCImageManifest=function(){var e=this;var c=["logo.png","soundon.png","soundoff.png","tnormal.png","ttachado.png","botomes.png","botomenys.png"];for(var d=0;d<c.length;d++){var f=e.getSrc(c[d]);f=f.replace("./","./motor/images/");e._manifest.push({id:f,src:f,name:c[d]})}};this.startMCImagePreload=function(){var c=this;c._preload=new createjs.LoadQueue();c._preload.on("fileload",function(d){c.onMCImageLoad(c,d)});c._preload.on("complete",function(d){c.onMCImageLoadComplete(c,d)});c._preload.setMaxConnections(3);c._preload.loadManifest(c._manifest)};this.onMCImageLoad=function(e,d){var c=e._preload.getResult(d.item.id);e._MCImages[d.item.name]=c};this.onMCImageLoadComplete=function(d,c){d.initDisplayMapaC();if(window.attachEvent){window.attachEvent("onresize",function(){d.onResizeEvent()})}else{if(window.addEventListener){window.addEventListener("resize",function(){d.onResizeEvent()},true)}}d._manifest=new Array();d.loadXML(d._sourceURL+"/"+d._sourceFile)};this.onDOMContentLoaded=function(c){var e=c;var d=navigator.userAgent;e._isIOS=(/iPhone|iPad|iPod/i.test(d));e._isNativeBrowser=((d.indexOf("Mozilla/5.0")>-1&&d.indexOf("Android ")>-1&&d.indexOf("AppleWebKit")>-1)&&!(d.indexOf("Chrome")>-1));TouchComp.init();e._mcCanvas=document.getElementById(e._mcContainerName);e._mcContainer=$(e._mcCanvas).parent().parent().parent()[0];if(e.needContainerSizePatch()){e._needPatch=true}e.loadMCImages()};this.onResizeEvent=function(){var c=this;if(c._isIOS){setTimeout(function(){c.reposition()},500)}else{c.reposition()}};this.reposition=function(){var f=this;var m=$(f._mcContainer).children(".html_mc").children(".mc_container")[0];var h=$(f._mcContainer);var o=h.width();var l=h.height();if(f._needPatch){var k=f.patchContainerSize();l=k.y;if(f._isIOS){o=k.x}}if(f.w!=o||f.h!=l){$(f._diapContainer).css("visibility","hidden");var j=$(m);var g=j.width();var e=j.height();var i;var d;var n=f.getScaledDimensions(o,l,m);i=n.x;d=n.y;var c=i/g;var p=d/e;j.css("-ms-transform-origin","0 0");j.css("-ms-transform-origin-x","0px");j.css("-ms-transform-origin-y","0px");j.css("-webkit-transform-origin-x","0px");j.css("-webkit-transform-origin-y","0px");j.css("-moz-transform-origin-x","0px");j.css("-moz-transform-origin-y","0px");j.css("-o-transform-origin-x","0px");j.css("-o-transform-origin-y","0px");j.css("transform-origin-x","0px");j.css("transform-origin-y","0px");j.css("transform-origin","0 0");j.css("margin-left",(o/2-(g*c)/2)+"px");j.css("top",(l/2-(e*p)/2)+"px");f.stage.scaleX=c;f.stage.scaleY=p;f.stage.canvas.width=i;f.stage.canvas.height=d;f.w=o;f.h=l;$(f._diapContainer).css("visibility","visible")}f.stage.update()};this.getScaledDimensions=function(i,g,f){var e=f;var c=i;var j=g;var h=e.offsetWidth;var d=e.offsetHeight;var k={x:0,y:0};if(c/j>h/d){k.y=j;k.x=h*(j/d)}else{k.x=c;k.y=d*(c/h)}return k};this.loadXML=function(c){var d=this;XDOM.newXMLFromURL(c,function(e){d.parseXML(e);d.startPreload();d.stage.scaleX=1;d.stage.scaleY=1;d.reposition();if(TouchComp.isTouchDevice()){createjs.Touch.enable(d.stage)}else{d.stage.enableMouseOver()}d._actionsReady=true},function(f,e){alert("Error al intentar procesar el archivo XML:\n- Status: "+f+".\n -Error: "+e)})};this.parseXML=function(j){var n=this;var w=$(j).children("mapa")[0];var g=$($(w).children("copyright")[0]).text();var e=$($(w).children("version")[0]).text();if(g!="(c) Editorial Planeta"||e!="1.0"){alert("Formato de mapa incorrecto")}else{var d=$.trim($(w).children("botonMapaMudo").text());var u=$(w).children("botonMudo");if(d.length>0){var p=[];for(var s=0;s<d.length;s++){p[s]="2"}p=p.join(",").replace(/,/g,"");var v=n.formatMCText(d,p,"center");var f=new createjs.HTMLText(v,"16px "+n.fontGlobal,"#000000");f.topMargin=6;f.leftMargin=3;f.rightMargin=3;f.bottomMargin=2;var m=f.getBounds();var r=m.width+5*2;var l=$.trim($(w).children("botonMapaConceptual").text());p=[];for(var s=0;s<l.length;s++){p[s]="2"}p=p.join(",").replace(/,/g,"");v=n.formatMCText(l,p,"center");var q=new createjs.HTMLText(v,"16px "+n.fontGlobal,"#000000");q.topMargin=6;q.leftMargin=3;q.rightMargin=3;q.bottomMargin=2;m=q.getBounds();var k=m.width+5*2;var t=Math.max(r,k);var i=n.bn_MM.x;var h=n.bn_MM.y;var o=n.shapeFactory.createRoundedCornersRect(f,t,n.BUTTON_H-7,1,3);o.x=i;o.y=h;n.bn_MM=o;n.bn_MM.cursor="pointer";n.botonera.removeChild(n.bn_MM);n.botonera.addChild(o);n.bn_MM.addEventListener("click",function(c){n.onClic_bn_MM(c,n)});var i=n.bn_MM.x;var h=n.bn_MM.y;var z=n.shapeFactory.createRoundedCornersRect(q,t,n.BUTTON_H-7,1,3);z.x=i;z.y=h;n.bn_MC=z;n.bn_MC.cursor="pointer";n.botonera.removeChild(n.bn_MC);n.botonera.addChild(z);n.bn_MC.addEventListener("click",function(c){n.onClic_bn_MC(c,n)});if(t>n.TEXT_BUTTON_W){n.botonera.x-=t-n.TEXT_BUTTON_W}}if(u.length>0){if($(u[0]).text()=="0"){n.bBnMudo=0}else{n.bBnMudo=1}}n.fillNodes(w)}};this.fillNodes=function(c){var e=this;e.lObjetos=new Array();e.llNiveles=new Array();for(var d=0;d<16;d++){e.llNiveles[d]=new Array()}e.qImagenes=0;e.qDescargas=0;e.bn_reproducir.visible=false;$(c).children("objeto").each(function(){var l=new Object();var f=$(this).children("ref");var m=$(this).children("audio");l.name=$.trim($(f[0]).text());l.audio=$.trim($(m[0]).text());if(l.audio.length>0){e.bn_reproducir.visible=true}var n=$.trim($($(this).children("texto")[0]).text());var h="";for(var j=0;j<n.length;j++){var s=n[j];var q=n.charCodeAt(j);if(q!=10){h+=s}}l.texto=n;n=$.trim($($(this).children("hijos")[0]).text());if(n.length==0){l.lHijos=new Array()}else{var i=n.split(",");l.lHijos=i}l.padre=$.trim($($(this).children("padre")[0]).text());var o=l.name.charAt(0);l.nivel=parseInt(o,16);l.siz=parseInt($.trim($($(this).children("siz")[0]).text()));l.cen=parseInt($.trim($($(this).children("cen")[0]).text()));var t=$.trim($($(this).children("negcur")[0]).text());l.lNEGCUR=t;e.llNiveles[l.nivel].push(l.name);l.img=$.trim($($(this).children("img")[0]).text());if(l.img.length>0){e.qImagenes++;var p=e.getSrcData(l.img);if(e._hashImages.hasOwnProperty(p)==false){e._hashImages[p]=new Array();e._manifest.push({id:p,src:p,name:l.name})}e._hashImages[p].push(l.name)}else{l.imagen=undefined}if(l.audio!=""){var g=e.getSrc(l.audio);g=g.replace("./","./data/sonidos/");var r=XAUDIO.audioCreateTag(g);l.audioIndex=r}e._indexedObjects[l.name]=l;e.lObjetos.push(l)});if(e.qImagenes==0){e.pintarMapa()}};this.getSrcData=function(e){var d=this;var c=e;if(e.indexOf(".")==0){c=e.substring(1,e.length)}if(c.indexOf("/")!=0){c="/"+c}c=c.replace(".swf",".png");return d._sourceURL+"/data/imagenes"+c};this.getSrc=function(e){var d=this;var c=e;if(e.indexOf(".")==0){c=e.substring(1,e.length)}if(c.indexOf("/")!=0){c="/"+c}c=c.replace(".swf",".png");return d._sourceURL+c};this.startPreload=function(){var c=this;c._preload=new createjs.LoadQueue();c._preload.on("fileload",function(d){c.handleAssetLoad(c,d)});c._preload.on("complete",function(d){c.imageLoadComplete(c,d)});c._preload.setMaxConnections(3);c._preload.loadManifest(c._manifest)};this.handleAssetLoad=function(f,e){var c=f._preload.getResult(e.item.id);for(var g in f._hashImages[e.item.id]){var h=f._hashImages[e.item.id][g];var d=f._indexedObjects[h];d.imagen=c;f.qDescargas++}};this.imageLoadComplete=function(d,c){d._hashImages=null;d.pintarMapa()};this.pintarMapa=function(){var q=this;q.vaciarContainer(q.papel,true);q.supra_papel.addChild(q.logo);var l=new Array();q.lCajasColgadas=new Array();q.lConectoresColgados=new Array();if(q.bBnMudo==0){q.bn_mudo.visible=false}else{q.bn_mudo.visible=true}var E=q.crearCAJ("00");E.name="00";q._indexedObjects["00"].caja=E;var B=q.MC_WIDTH/2;q.colgarCAJ(E,[B-E.width/2,10]);l[0]=["00"];var A=q.getQNiveles();for(var C=2;C<A;C+=2){l[C]=new Array();for(var J in l[C-2]){var j=q._indexedObjects[l[C-2][J]];var L=j.lHijos.length;var d=j.caja.x+j.caja.width/2;var u=j.caja.y+j.caja.h2+((j.name=="00")?0:20);var F=d;var K;var I=new createjs.Shape();j.trazos=I;q.papel.addChild(I);I.graphics.setStrokeStyle(2);I.graphics.beginStroke("#727CDD");I.graphics.moveTo(d,u);if(L==1){var y=j.lHijos[0];q._indexedObjects["c"+y]=q.crearCON(y);if(q._indexedObjects[y].texto!=""){q.colgarCON(q._indexedObjects["c"+y],[d,u+10]);K=u+10+q._indexedObjects["c"+y].height+10}else{K=u+10}I.graphics.lineTo(F,K);var s=q._indexedObjects[y];var v=s.lHijos;var z=v.length;var H=q.getWidthTotal(v);var n;var M;if(C==2){M=(q.MC_WIDTH-H)/z;n=M/2}else{var o=q.luzInterGlobal*(z-1)+H;n=F-o/2}var m=false;if(n<q.luzInterGlobal){n=q.luzInterGlobal;if(v.length==1){m=true}}if(q.MC_WIDTH-(n+o)<q.luzInterGlobal){n=q.MC_WIDTH-o-q.luzInterGlobal;if(v.length==1){m=true}}for(var t in v){E=q.crearCAJ(v[t]);E.name=v[t];q._indexedObjects[v[t]].caja=E;l[C].push(v[t]);q.colgarCAJ(E,[n,K+10]);if(C>2){n=E.x+E.width+q.luzInterGlobal}else{n=E.x+E.width+M}if(m){I.graphics.moveTo(F,E.y);I.graphics.lineTo(F,K)}else{I.graphics.moveTo(E.x+E.width/2,E.y);I.graphics.lineTo(E.x+E.width/2,K)}I.graphics.lineTo(F,K);q.colgarFlecha(E)}}else{if(L>1){K=u+10;I.graphics.lineTo(F,K);var f=j.lHijos.slice();var h=q.getHeightMax(f);if(h>0){var D=K+h+30}else{D=K+20}var x=j.lHijos.length;var G=0;for(var c in f){G+=q.getWidthTotal(q._indexedObjects[f[c]].lHijos)+q.luzInterGlobal*(q._indexedObjects[f[c]].lHijos.length-1)+q.luzInterGlobal}if(C==2){var r=(q.MC_WIDTH-G)/x;n=r/2-q.luzInterGlobal-r;for(var c in j.lHijos){s=q._indexedObjects[j.lHijos[c]];var k=n+q.luzInterGlobal+r+(q.getWidthTotal(s.lHijos)+2*(s.lHijos.length-1))/2;n+=r;for(var t in s.lHijos){var w=s.lHijos[t];n+=q.luzInterGlobal;E=q.crearCAJ(w);E.name=w;q._indexedObjects[w].caja=E;l[C].push(w);q.colgarCAJ(E,[n,D]);n=E.x+E.width;I.graphics.moveTo(E.x+E.width/2,E.y);I.graphics.lineTo(E.x+E.width/2,E.y-10);I.graphics.lineTo(k,E.y-10);I.graphics.lineTo(k,K);I.graphics.lineTo(F,K);q.colgarFlecha(E)}q._indexedObjects["c"+j.lHijos[c]]=q.crearCON(j.lHijos[c]);if(q._indexedObjects[j.lHijos[c]].texto!=""){q.colgarCON(q._indexedObjects["c"+j.lHijos[c]],[k,K+10])}}}else{n=d-G/2;n=Math.max(2,n);var N=n+G-q.MC_WIDTH;if(N>0){n-=N}for(var c in j.lHijos){s=q._indexedObjects[j.lHijos[c]];k=n+(q.getWidthTotal(q._indexedObjects[j.lHijos[c]].lHijos)+q.luzInterGlobal*(q._indexedObjects[j.lHijos[c]].lHijos.length-1))/2;for(var t in s.lHijos){var w=s.lHijos[t];E=q.crearCAJ(w);E.name=w;q._indexedObjects[w].caja=E;l[C].push(w);q.colgarCAJ(E,[n,D]);n=E.x+E.width+q.luzInterGlobal;I.graphics.moveTo(E.x+E.width/2,E.y);I.graphics.lineTo(E.x+E.width/2,E.y-10);I.graphics.lineTo(k,E.y-10);I.graphics.lineTo(k,K);I.graphics.lineTo(F,K);q.colgarFlecha(E)}q._indexedObjects["c"+j.lHijos[c]]=q.crearCON(j.lHijos[c]);if(q._indexedObjects[j.lHijos[c]].texto!=""){q.colgarCON(q._indexedObjects["c"+j.lHijos[c]],[k,K+10])}}}}}}}for(var e in q._indexedObjects["00"].lHijos){var i=q._indexedObjects["00"].lHijos[e];for(var g in q._indexedObjects[i].lHijos){var p=q._indexedObjects[i].lHijos[g];q.ocultarArbol(p)}}q.papel.visible=true;q.co_tablero.visible=false;q.bn_MM.visible=false;q.bn_MC.visible=false;q.mouseDownEv=q.papel.addEventListener("mousedown",function(O){q.onDN_papel(O,q)});q.bReproduciendo=false;q.stage.update()};this.vaciarContainer=function(e,c){if(c==undefined){c=false}while(e.numChildren>0){var d=e.removeChildAt(0);if(c){d=null}}};this.crearCAJ=function(d){var x=this;var s=x._indexedObjects[d];if(s.caja!=undefined&&s.caja!=null){return s.caja}else{}var k=0;var h=0;var l;var e=s.nivel;var z=(e>6)?"#444CA1":"#FFFFFF";var u=s.siz;if(s.texto.length>0){if(s.siz==0){if(e>6){u=14}else{u=[20,0,18,0,16,0,14][e]}}else{u=s.siz;s.siz=u}var y=(s.cen==1)?"center":"left";var B=x.formatMCText(s.texto,s.lNEGCUR,y);var l=new createjs.HTMLText(B,u+"px "+x.fontGlobal,z);l.topMargin=6;l.leftMargin=3;l.rightMargin=3;l.bottomMargin=2;l.lineHeight=x.lInterlineados[u];var i=l.getBounds();k=i.width;h=i.height;l.width=i.width;l.height=i.height}var p=0;var o=0;var C,t;if(s.imagen!=undefined){C=s.imagen;p=C.width*x.IMAGE_SCALE;o=C.height*x.IMAGE_SCALE;t=new createjs.Bitmap(C);t.scaleX=x.IMAGE_SCALE;t.scaleY=x.IMAGE_SCALE}var r=Math.max(k,p);var A=h+o;var n=new createjs.Container();var q=new createjs.Container();var m=new createjs.Shape();var c;switch(e){case 0:c="#0625B4";break;case 2:c="#002AAD";break;case 4:c="#1940FF";break;case 6:c="#6781F2";break;case 8:c="#0A2590";break;case 10:c="#727CDD";break}if(k>0){switch(e){case 0:m.graphics.beginFill("#0625B4");break;case 2:m.graphics.beginFill("#002AAD");break;case 4:m.graphics.beginFill("#1940FF");break;case 6:m.graphics.beginFill("#6781f2");break;case 8:m.graphics.beginFill("#FFFFFF");m.graphics.setStrokeStyle(1);m.graphics.beginStroke("#0A2590");break;case 10:m.graphics.beginFill("#FFFFFF");m.graphics.setStrokeStyle(1);m.graphics.beginStroke("#727CDD");break}m.graphics.drawRect(0,0,r+8,h);m.graphics.endFill();if(l!=undefined){l.x=(r+8-k)/2;l.y=0;n.texto=l;q.addChild(m);q.addChild(l);n.addChild(q)}}n.width=r;n.height=h;var g=0;if(p>0){t.x=(r+8-p)/2;var j=n.height;t.y=j+5;n.img=t;var w=new createjs.Shape();w.graphics.beginFill("#FFFFFF",0);w.graphics.drawRect(0,j,r+8,o+11);w.graphics.endFill();n.addChild(w);n.addChild(t);w.graphics.setStrokeStyle(1);w.graphics.beginStroke(c);w.graphics.drawRect(0,j,r+8,o+11);g=11}n.h2=A+g;if(s.audio!=""){var v=x.shapeFactory.createTriangle(x.FLECHA_AUDIO_W,x.FLECHA_AUDIO_H,true,false,"#444CA1");var f=x.shapeFactory.embedShape(x.shapeFactory.addRoundedBorder(v,2,1,"#444CA1"),15);x.lPictosAudio.push(f);n.addChild(f);f.x=n.x-9;f.y=n.y-5;f.addEventListener("click",function(D){D.stopPropagation();x.onClickPlaySound(D,x,s.audioIndex)});if(x.bReproduciendo==false){f.visible=false}else{f.visible=true}}return n};this.crearCON=function(l){var c=this;var g=c._indexedObjects[l];var m=g.siz;if(g.texto.length>0){if(g.siz==0){m=14;g.siz=m}else{m=g.siz;g.siz=m}}var f=(g.cen==1)?"center":"left";var j=c.formatMCText(c._indexedObjects[l].texto,g.lNEGCUR,f);var e=new createjs.HTMLText(j,m+"px "+c.fontGlobal,"#444CA1");e.topMargin=6;e.leftMargin=3;e.rightMargin=3;e.bottomMargin=0;e.lineHeight=c.lInterlineados[m];var d;var i;if(e.text.length==0){d=0;i=0}else{var n=e.getBounds();d=n.width;i=n.height+4}var k=new createjs.Container();var h=new createjs.Shape();h.graphics.beginFill("#FFFFFF");h.graphics.setStrokeStyle(1);h.graphics.beginStroke("#FFFFFF");h.graphics.drawRect(0,0,d,i);h.graphics.endFill();k.addChild(h);k.addChild(e);k.name=l;k.width=d;k.height=i;return k};this.colgarCAJ=function(c,e){var d=this;c.x=e[0];c.y=e[1];c.addEventListener("click",function(f){d.onClic_caja(f,d,c.name)});if(c.name!="00"){c.cursor="pointer"}d.papel.addChild(c);d.lCajasColgadas.push(c)};this.getQNiveles=function(){var e=this;var c=0;for(var d=0;d<16;d++){if(e.llNiveles[d].length>0){c++}}return c};this.colgarCON=function(c,g){var e=this;var f=Math.max(10,g[0]-c.width/2);var d=f+c.width-e.MC_WIDTH+10;if(d>0){f-=d}c.x=f;c.y=g[1];e.papel.addChild(c);e.lConectoresColgados.push(c)};this.mostrarArbol=function(i){var h=this;var g=h._indexedObjects[i];h._indexedObjects["flechaUp_"+i].visible=true;h._indexedObjects["flechaDn_"+i].visible=false;g.trazos.visible=true;for(var f in g.lHijos){var d=g.lHijos[f];h.papel.addChild(h._indexedObjects["c"+d]);h._indexedObjects["c"+d].visible=true;h.chequeaColision(h._indexedObjects["c"+d]);for(var c in h._indexedObjects[d].lHijos){var e=h._indexedObjects[d].lHijos[c];h.papel.addChild(h._indexedObjects[e].caja);h._indexedObjects[e].caja.visible=true;h.chequeaColision(h._indexedObjects[e].caja)}}h.bn_MM.visible=true;h.bn_MC.visible=false;h.stage.update()};this.ocultarArbol=function(h){if(h.length==0){return}var g=this;var f=g._indexedObjects[h];if(f.lHijos.length==0){return}else{if(g._indexedObjects["flechaUp_"+h]!=undefined){g._indexedObjects["flechaUp_"+h].visible=false}if(g._indexedObjects["flechaDn_"+h]!=undefined){g._indexedObjects["flechaDn_"+h].visible=true}f.trazos.visible=false;for(var e in f.lHijos){g._indexedObjects["c"+f.lHijos[e]].visible=false;for(var c in g._indexedObjects[f.lHijos[e]].lHijos){var d=g._indexedObjects[f.lHijos[e]].lHijos[c];g._indexedObjects[d].caja.visible=false;g.ocultarArbol(d)}}}g.stage.update()};this.colgarFlecha=function(c){var e=this;if(e._indexedObjects[c.name].lHijos.length>0){var g=c.h2;if(e._indexedObjects["flechaUp_"+c.name]==undefined){var d=e.flechaUp.clone(true);d.x=c.width/2-(e.flechaUp.width/2);d.y=g+2;d.cursor="pointer";c.addChild(d);d.addEventListener("click",function(h){e.onClic_flechaUp(h,e,c.name)});e._indexedObjects["flechaUp_"+c.name]=d}if(e._indexedObjects["flechaDn_"+c.name]==undefined){var f=e.flechaDn.clone(true);f.x=c.width/2-(e.flechaDn.width/2);f.y=g+1;f.cursor="pointer";c.addChild(f);f.addEventListener("click",function(h){e.onClic_flechaDn(h,e,c.name)});e._indexedObjects["flechaDn_"+c.name]=f}}};this.formatMCText=function(m,l,j){var k=new Array();var d;var g=0;if(!l){l=""}if(l.length<m.length){for(var h=0;h<m.length-l.length;h++){l+="0"}}d=new createjs.HTMLTextPara();d.align=j;var n="";var c=l.charAt(0);var o=true;while(g<m.length){if(m.charAt(g)=="\r"||m.charAt(g)=="\n"){if(n!=""){var f=new createjs.HTMLTextRun(n,"");d.items.push(f);n=""}k.push(d);d=new createjs.HTMLTextPara();d.align=j}else{if(c!=l.charAt(g)||(o&&c!=0)){var e="";if(c=="1"){e="italic"}else{if(c=="2"){e="bold"}}var f=new createjs.HTMLTextRun(n,e);d.items.push(f);n=m.charAt(g);c=l.charAt(g);o=false}else{n+=m.charAt(g)}}g++}if(n!=""){var f=new createjs.HTMLTextRun(n,c);d.items.push(f);n=""}if(d.items.length>0){k.push(d)}return k};this.getWidthTotal=function(e){var f=this;var c=0;for(var g in e){var d=f.crearCAJ(e[g]);if(f._indexedObjects[e[g]].caja==undefined){f._indexedObjects[e[g]].caja=d}if(d.width!=null&&d.width!=undefined&&!isNaN(d.width)){c+=d.width}d=null}return c};this.getHeightMax=function(e){var f=this;var c=0;for(var g in e){if(f._indexedObjects[e[g]].texto!=""){var d=f.crearCON(e[g]);if(d.height>c){c=d.height}d=null}}return c};this.chequeaColision=function(f){var e=this;for(var h in e.lCajasColgadas){var d=e.lCajasColgadas[h];if(d.visible&&e.hitTestObject(f,d)){if(d.name!=f.name){e.ocultarArbol(e.getAbuelo(d.name))}}}for(var g in e.lConectoresColgados){var c=e.lConectoresColgados[g];if(c.visible&&e.hitTestObject(f,c)){if(c.name!=f.name){e.ocultarArbol(e._indexedObjects[c.name].padre)}}}return true};this.getAbuelo=function(d){var c=this;if(c._indexedObjects[c._indexedObjects[d].padre]==undefined){return""}return c._indexedObjects[c._indexedObjects[d].padre].padre};this.hitTestObject=function(i,g){var c=this;var m=(i.h2!=undefined)?i.h2:i.height;var l=(g.h2!=undefined)?g.h2:g.height;var h=i.localToGlobal(0,0).x;var e=i.localToGlobal(i.width,0).x;var k=i.localToGlobal(0,0).y;var o=i.localToGlobal(0,m).y;var f=g.localToGlobal(0,0).x;var d=g.localToGlobal(g.width,0).x;var j=g.localToGlobal(0,0).y;var n=g.localToGlobal(0,l).y;return c.intersectRect(i,{left:h,right:e,top:k,bottom:o},g,{left:f,right:d,top:j,bottom:n})};this.intersectRect=function(f,d,e,c){return !(c.left>d.right+5||c.right<d.left-5||c.top>d.bottom+5||c.bottom<d.top-5)};this.styleToObject=function(f){var g=f.split(";");var e;var d=new Object();for(e=0;e<g.length;e++){var c=g[e].trim();if(c==""){continue}var h=g[e].split(":");d[h[0].toLowerCase().trim()]=h[1].toLowerCase().trim()}return d};this.needContainerSizePatch=function(){var e=this;if($(e._mcContainer).parent().is("body")==false){return false}var d=$(e._mcContainer).attr("style");if(d){var c=this.styleToObject(d);if(c.height=="100%"){return true}}return false};this.patchContainerSize=function(){var c=window.innerWidth?window.innerWidth:$(window).width();var f=window.innerHeight?window.innerHeight:$(window).height();var e="none";if(this._isIOS){var d=window;while(d.parent!=null&&d.parent!=d){d=d.parent}if(d.orientation==0||d.orientation==180){if(c>768){c=768}e="v:"+d.orientation}else{e="h: "+d.orientation}}return{x:c,y:f}};this.onClic_caja=function(h,g,k){var f=g._indexedObjects[k];if(g.bReproduciendo==true){if(f.audio!=""){g.onClickPlaySound(h,g,f.audioIndex)}return}if(g.bOcultando==true){if(k!="00"){var c=null;for(var j in g.lCajasColgadas){var d=g.lCajasColgadas[j];if(d.name==k){c=d}}var i=false;if(c.texto!=null&&c.texto!=undefined){c.texto.visible=!c.texto.visible;i=true}if(c.img!=undefined){c.img.visible=!c.img.visible;i=true}if(i==true&&c!=null){g.stage.update()}}}else{if(k!="00"&&g._indexedObjects[k].lHijos.length>0){if(g._indexedObjects["flechaUp_"+k]==undefined){return}if(g._indexedObjects["flechaUp_"+k].visible==true){g.onClic_flechaUp(h,g,k)}else{if(g._indexedObjects["flechaDn_"+k].visible==true){g.onClic_flechaDn(h,g,k)}}}}};this.onClic_flechaDn=function(f,d,c){f.stopImmediatePropagation();d._indexedObjects["flechaUp_"+c].visible=true;d.mostrarArbol(c)};this.onClic_flechaUp=function(f,d,c){f.stopImmediatePropagation();d._indexedObjects["flechaDn_"+c].visible=true;d.ocultarArbol(c)};this.onClic_Mudo=function(g,f){f.bReproduciendo=false;f.bn_reproducir.mostrar.visible=false;f.bn_reproducir.ocultar.visible=true;for(var d=0;d<f.lPictosAudio.length;d++){f.lPictosAudio[d].visible=false}f.bOcultando=!f.bOcultando;if(f.bOcultando){f.bn_mudo.mostrar.visible=true;f.bn_mudo.ocultar.visible=false}else{f.bn_mudo.mostrar.visible=false;f.bn_mudo.ocultar.visible=true;f.bn_MM.visible=true;f.bn_MC.visible=false;for(var h in f.lCajasColgadas){var c=f.lCajasColgadas[h];if(c.texto!=null){c.texto.visible=true}if(c.img){c.img.visible=true}}}f.stage.update()};this.onClic_bn_MM=function(f,d){d.bn_MM.visible=false;d.bn_MC.visible=true;d.lCajasMudas=new Array();for(var g in d.lCajasColgadas){var c=d.lCajasColgadas[g];if(d._indexedObjects[c.name].nivel>2&&c.visible){if(c.texto!=null){c.texto.visible=false}if(c.img){c.img.visible=false}d.lCajasMudas.push(c)}}d.papel.addChild(d.tapaFantasma);d.tapaFantasma.visible=true;d.stage.update()};this.onClic_bn_MC=function(f,d){d.bn_MM.visible=true;d.bn_MC.visible=false;for(var g in d.lCajasMudas){var c=d.lCajasMudas[g];if(c.texto!=null){c.texto.visible=true}if(c.img){c.img.visible=true}}d.papel.removeChild(d.tapaFantasma);d.stage.update()};this.onClic_Reproducir=function(f,d){d.bOcultando=false;d.bn_mudo.mostrar.visible=false;d.bn_mudo.ocultar.visible=true;d.bReproduciendo=!d.bReproduciendo;if(d.bReproduciendo){d.bn_reproducir.mostrar.visible=true;d.bn_reproducir.ocultar.visible=false;for(var c=0;c<d.lPictosAudio.length;c++){d.lPictosAudio[c].visible=true}}else{d.bn_reproducir.mostrar.visible=false;d.bn_reproducir.ocultar.visible=true;d.tapaFantasma.visible=false;for(var c=0;c<d.lPictosAudio.length;c++){d.lPictosAudio[c].visible=false}}d.stage.update()};this.onClickPlaySound=function(f,d,c){XAUDIO.audioStart(c)};this.onClic_bn_zoom=function(f,d,c){if(c=="bn_zoom_mas"){if(d.zoomPapel<2){d.zoomPapel+=0.25;d.papel.scaleX=d.papel.scaleY=d.zoomPapel}}else{if(d.zoomPapel>1){d.zoomPapel-=0.25;d.papel.scaleX=d.papel.scaleY=d.zoomPapel}}switch(d.zoomPapel){case 1:d.bn_zoom_men.visible=false;if(d.mouseDownEv==null){d.mouseDownEv=d.papel.addEventListener("mousedown",function(e){d.onDN_papel(e,d)})}d.papel.x=d.papel.y=0;break;case 2:d.bn_zoom_mas.visible=false;if(d.mouseDownEv==null){d.mouseDownEv=d.papel.addEventListener("mousedown",function(e){d.onDN_papel(e,d)})}break;default:d.bn_zoom_mas.visible=true;d.bn_zoom_men.visible=true;if(d.mouseDownEv==null){d.mouseDownEv=d.papel.addEventListener("mousedown",function(e){d.onDN_papel(e,d)})}break}d.stage.update()};this.onDN_papel=function(d,c){if(c.mouseUpEv==null){c.mouseUpEv=d.addEventListener("mouseup",function(e){c.onUP_papel(e,c)});if(c.mouseMoveEv==null){c.mouseMoveEv=d.addEventListener("mousemove",function(e){c.onMOVE_papel(e,c)})}}};this.onUP_papel=function(d,c){if(c.mouseUpEv!=null){c.papel.removeEventListener("mouseup",c.mouseUpEv);c.mouseUpEv=null;if(c.mouseMoveEv!=null){c.papel.removeEventListener("mousemove",c.mouseMoveEv);c.mouseMoveEv=null;c.antX=undefined;c.antY=undefined}}};this.onMOVE_papel=function(d,c){if(c.antX==undefined){c.antX=d.stageX}if(c.antY==undefined){c.antY=d.stageY}c.papel.x+=d.stageX-c.antX;c.papel.y+=d.stageY-c.antY;c.stage.update();c.antX=d.stageX;c.antY=d.stageY}};