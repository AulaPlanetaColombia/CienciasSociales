/* VERSION : 15.7.18.1 */ 
var pppUI;(function(a){(function(i){function h(n,p,o,m,r){if(typeof r==="undefined"){r=true}var q=new a.UIObject(n);q.addClass(o);if(r&&TLF.isTLF(p)){q.addClass("tlfText");q.setContent(TLF.toHTML(p,function(s){return FUtils.realResourcePath(s)}))}else{q.setContent(p)}q.position=m;return q}i.createTextBox=h;function g(n,s,q,m,p,r){var o=new a.UIButton(n,q,p,s);o.command=r;o.position=m;return o}i.createEventButton=g;function l(u,q,v,m,t,n,s){if(typeof s==="undefined"){s=a.UIButton.BUTTON}var o;var r=new Array();for(o=0;o<t.length;o++){var p=new a.UIButton(t[o].id,t[o].className,s,t[o].content);if(m){p.x=q.x;p.y=q.y+o*v}else{p.x=q.x+o*v;p.y=q.y}p.width=q.width;p.height=q.height;p.visible=t[o].visible;p.command=n;u.addChild(p);r.push(p)}return r}i.createButtonList=l;function f(p,s,r,q){if(typeof q==="undefined"){q=a.UIButton.BUTTON}var o;var n=new Array();for(o=0;o<s.length;o++){var m=new a.UIButton(s[o].id,s[o].className,q,s[o].content);m.position=s[o].position;m.visible=s[o].visible;m.command=r;p.addChild(m);n.push(m)}return n}i.createButtonListVarPos=f;function e(r,m,n,t,s){var q;var p=new Array();for(q=0;q<t.length;q++){var o=new a.UIButton(t[q].id,t[q].className,a.UIButton.BUTTON,t[q].content);o.x=m.x;o.y=m.y+q*n;o.width=m.width;o.height=m.height;o.visible=t[q].visible;o.command=s;r.addChild(o);p.push(o)}return p}i.createButtonColumn2=e;function d(v,r,n,m,u,w,o){var p;var s=r.y;var t=new Array();for(p=0;p<u.length&&p<w;p++){var q=new a.UIButton(u[p].id,u[p].className,2,u[p].content);q.x=(p<u.length/2)?r.x:r.x+n;q.y=s+Math.floor(p%(u.length/2))*m;q.width=r.width;q.height=r.height;q.visible=u[p].visible;q.command=o;v.addChild(q);t.push(q)}return t}i.createButton2Columns=d;function j(v,q,x,n,u,o,p,t,r,w){if(typeof r==="undefined"){r="slideContainer"}if(typeof w==="undefined"){w=""}var m=new a.UISlider(r);m.addClass(w);m.position=t;v.addChild(m);var s=l(v,q,x,n,u,o,p);s.push(m);return s}i.createButtonsTabs=j;function c(n,m){if(n==null||n.DOMItem==null){return}var o=n.DOMItem;if(n instanceof a.UIRichText){o=n.$DOMItem.find("#realContent")[0];if(o==null){return}}if((o.scrollHeight-o.clientHeight)>3){var p=new a.UIImage("scrollMarker","","motor/images/scrollmarkertrans.png",a.UIImage.ADJUSTMODE_NONE,39,39);p.x=n.x+n.width-39-((m)?10:20);p.y=n.y+n.height-39-10;p.visible=false;n.parent.addChild(p);p.fadeIn(600);setTimeout(function(){if(p.DOMItem){p.fadeOut(500,function(){if(p.DOMItem){p.remove()}})}},2000)}}function k(o,n){var m=(navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile|Touch/i)!=null);var p=(navigator.userAgent.match(/Trident/i)!=null)&&(navigator.userAgent.match(/Touch/i)!=null);if(n==true&&m==false||p){return}setTimeout(function(){c(o,m)},500)}i.showScrollMarker=k})(a.Utils||(a.Utils={}));var b=a.Utils})(pppUI||(pppUI={}));var FUtils;(function(b){function c(g){if((g.indexOf("data/imagenes/")==0)||(g.indexOf("data/sonidos/")==0)||(g.indexOf("data/videos/")==0)||(g.indexOf("data/recursos/")==0)||(g.indexOf("data/actividades/")==0)||(g=="data/datos.xml")){return g}if(g.indexOf("medias/")==0){g=g.substring("medias/".length)}var f=g.substr(g.lastIndexOf(".")+1).toLowerCase();switch(f){case"jpg":case"jpeg":case"gif":case"png":case"svg":case"bmp":return"data/imagenes/"+g;case"swf":return"data/imagenes/"+g.replace(/\.swf/i,".png");case"mp4":return"data/videos/"+g;case"flv":return"data/videos/"+g.replace(/\.flv/i,".mp4");case"mp3":case"wav":return"data/sonidos/"+g;case"zip":return"data/actividades/"+g.replace(/\.zip/,"_zip")+"/Principal.html";case"xml":return"data/"+g;default:return"data/imagenes/"+g}}b.realResourcePath=c;var e={blocks:[{type:"img",files:[]}],spinner:"no",waitForDocumentReady:false,onEndLoading:null};function d(h,g){if(h==null||h==undefined||g==null||g==undefined||h==""||g==""){return}for(var f=0;f<e.blocks[0].files.length;f++){if(e.blocks[0].files[f].from==h&&e.blocks[0].files[f].file==g){return}}e.blocks[0].files.push({from:h,file:g})}b.addImageToPreloader=d;function a(f){if(e.blocks[0].files.length==0){f(e)}else{e.onEndLoading=f;pppPreloader.loadManifest(e)}}b.preloadImages=a})(FUtils||(FUtils={}));var __extends=this.__extends||function(f,a){for(var e in a){if(a.hasOwnProperty(e)){f[e]=a[e]}}function c(){this.constructor=f}c.prototype=a.prototype;f.prototype=new c()};var MAIN_TITLE_POS={x:100,y:0,width:745,height:105};var WATERMARK_POS={x:20,y:20,width:62,height:62};var conte;var conteDoc;var gameMap=(function(){function a(){}return a})();var gameAnswer=(function(){function a(){}return a})();var gameQuestion=(function(){function a(){}return a})();var gameData=(function(){function a(){}return a})();var mapCanvas=(function(a){__extends(b,a);function b(d){a.call(this,d);this.onHit=null;var c=this;this.$DOMItem.mousedown(function(e){c.onMouseDown(e)})}b.prototype.onMouseDown=function(d){var e=this.globalPosition;var c=d.clientX-e.x;var f=d.clientY-e.y;c/=e.width/this.width;f/=e.height/this.height;if(c>this.bounds.x&&c<(this.bounds.x+this.bounds.width)&&f>this.bounds.y&&f<(this.bounds.y+this.bounds.height)){if(this.onHit!=null){this.onHit(this,true)}}else{if(this.onHit!=null){this.onHit(this,false)}}};b.prototype.toColor=function(e,i){if(typeof i==="undefined"){i=null}e>>>=0;var c=e&255,h=(e&65280)>>>8,f=(e&16711680)>>>16,d=((e&4278190080)>>>24)/255;if(i!=null){d=i}return"rgba("+[f,h,c,d].join(",")+")"};b.prototype.drawMap=function(){this.clear();var e=this.canvas.getContext("2d");switch(this.map.type){case 1:e.fillStyle=this.toColor(theGame.color,1);e.beginPath();e.arc(this.map.points[0].x,this.map.points[0].y,(theGame.mode==1)?8:16,0,2*Math.PI,false);e.closePath();e.fill();break;case 2:case 3:var c=1;if(theGame.mode==1){c=(this.map.type==2?4:2)}else{c=(this.map.type==2?12:2)}e.strokeStyle=this.toColor(theGame.color,1);e.fillStyle=this.toColor(theGame.color,0.5);e.beginPath();e.moveTo(this.map.points[0].x,this.map.points[1].y);for(var d=1;d<this.map.points.length;d++){e.lineTo(this.map.points[d].x,this.map.points[d].y)}e.closePath();e.fill();e.stroke();break}this.calcBounds()};b.prototype.calcBounds=function(){if(this.map.type==1){this.bounds={x:this.map.points[0].x-30,y:this.map.points[0].y-30,width:60,height:60}}else{var d=9999;var c=9999;var h=-9999;var f=-9999;for(var e=0;e<this.map.points.length;e++){var g=this.map.points[e];if(d>=g.x){d=g.x}if(c>=g.y){c=g.y}if(h<=g.x){h=g.x}if(f<=g.y){f=g.y}}d-=10;c-=10;h+=10;f+=10;this.bounds={x:d,y:c,width:h-d,height:f-c}}};b.prototype.setMap=function(c){this.map=c;this.drawMap()};return b})(pppUI.UICanvas);var theGame=null;function getLayoutPos(c,b,e){var a=16;var d=[{q:{x:74,y:90},p:{x:950-74-b.width,y:90}},{q:{x:950-74-e.width,y:90},p:{x:74,y:90}},{q:{x:74,y:608-a-e.height},p:{x:950-74-b.width,y:608-a-b.height}},{q:{x:950-74-e.width,y:608-a-e.height},p:{x:74,y:608-a-b.height}}];return d[c]}function createPuntuacion(d,b){var c=new pppUI.UIObject("punt");c.setCSSClass("graybox");c.position={x:0,y:0,width:208,height:34};var a=new pppUI.UISimpleText("title","puntText",d);a.position={x:6,y:4,width:119,height:27};a.alignMode=pppUI.UISimpleText.ALIGN_RIGHT|pppUI.UISimpleText.ALIGN_MIDDLE;c.addChild(a);a=new pppUI.UISimpleText("punt","puntText",b);a.position={x:127,y:4,width:74,height:27};a.alignMode=pppUI.UISimpleText.ALIGN_RIGHT|pppUI.UISimpleText.ALIGN_MIDDLE;c.addChild(a);return c}function createPreguntaWithButtons(b,f,e){var g=new pppUI.UIObject("pregunta");g.setCSSClass("graybox");g.position={x:0,y:0,width:196+8,height:234};var a=new pppUI.UISimpleText("title","pregText",b,0);a.position={x:4,y:3,width:188+8,height:64};a.alignMode=pppUI.UISimpleText.ALIGN_CENTER|pppUI.UISimpleText.ALIGN_TOP;g.addChild(a);for(var d=0;d<f.length;d++){var c=new pppUI.UITextButton("btn"+d,"respRoundTextButton",pppUI.UIButton.BUTTON,f[d].text,true,2);c.position={x:7,y:70-5+d*33,width:182+8,height:30};c.extra.index=d;c.command=function(i,j){var h=_current.answers[j.extra.index].correct;gameRespond(h)};g.addChild(c)}return g}function createPregunta(c,e,b){if(typeof b==="undefined"){b=null}var d=new pppUI.UIObject("pregunta");d.setCSSClass("graybox");d.position={x:0,y:0,width:196+8,height:(b==null)?112:193};var a=new pppUI.UISimpleText("title","pregText",c,0);a.position={x:4,y:3,width:188+8,height:64};a.alignMode=pppUI.UISimpleText.ALIGN_CENTER|pppUI.UISimpleText.ALIGN_TOP;d.addChild(a);if(b!=null){a=new pppUI.UISimpleText("desc","pregDesc",b,0);a.position={x:4,y:69-10,width:188+8,height:79};a.alignMode=pppUI.UISimpleText.ALIGN_CENTER|pppUI.UISimpleText.ALIGN_TOP;d.addChild(a)}a=new pppUI.UISimpleText("item","pregItem",e,0);a.position={x:4,y:(b==null)?69-10:149-10,width:188+8,height:70};a.alignMode=pppUI.UISimpleText.ALIGN_CENTER|pppUI.UISimpleText.ALIGN_TOP;d.addChild(a);return d}function createMarker(d,h,b,g){var f=200;var c=new pppUI.UIObject("marker");c.width=f;c.height=90;c.setCSSClass("marker");var e=new pppUI.UIImage("markerIcon","",g?pppPreloader.from("module","motor/images/g1_marker_resp_ok.png"):pppPreloader.from("module","motor/images/g1_marker_resp_ko.png"));e.x=(f-36)/2;e.y=0;c.addChild(e);var a=new pppUI.UISimpleText("item","markerText",h,0);a.position={x:0,y:34,width:f,height:50};a.alignMode=pppUI.UISimpleText.ALIGN_CENTER|pppUI.UISimpleText.ALIGN_TOP;c.addChild(a);c.x=b.x-f/2;c.y=b.y-36/2;d.addChild(c)}function createPopupResp(e,f){var b=new pppUI.UIPopup("popup","popupRespBk",true);b.onPrepare=function(g){g.refresh()};var d=new pppUI.UIObject("pasti");d.setCSSClass("popupRespPasti");d.position={x:0,y:0,width:336,height:146};b.addChild(d);var c=new pppUI.UIImage("icon","",e?pppPreloader.from("module","motor/images/g1_popup_resp_ok.png"):pppPreloader.from("module","motor/images/g1_popup_resp_ko.png"));c.x=22;c.y=39;d.addChild(c);var a=new pppUI.UISimpleText("message","popupRespText",f,0);a.position={x:95,y:34,width:227,height:78};a.alignMode=pppUI.UISimpleText.ALIGN_CENTER|pppUI.UISimpleText.ALIGN_MIDDLE;if(e){a.$DOMItem.css("color","#27BD26")}else{a.$DOMItem.css("color","#D43B40")}d.addChild(a);return b}function createPopupMsg(d){var b=new pppUI.UIPopup("popup","popupRespBk",true);b.onPrepare=function(e){e.refresh()};var c=new pppUI.UIObject("pasti");c.setCSSClass("popupRespPasti");c.position={x:0,y:0,width:336,height:110};b.addChild(c);var a=new pppUI.UISimpleText("message","popupMessageText",d,0);a.position={x:18,y:10,width:300,height:90};a.alignMode=pppUI.UISimpleText.ALIGN_CENTER|pppUI.UISimpleText.ALIGN_MIDDLE;c.addChild(a);return b}function createPopupFinal(d,f,h,g){var b=new pppUI.UIPopup("popup","popupRespBk",false);b.onPrepare=function(i){i.refresh()};var c=new pppUI.UIObject("pasti");c.setCSSClass("popupRespPasti");c.position={x:0,y:0,width:412,height:244};b.addChild(c);var a=new pppUI.UISimpleText("message","popupRespText",d);a.position={x:2,y:8,width:408,height:78};a.alignMode=pppUI.UISimpleText.ALIGN_CENTER|pppUI.UISimpleText.ALIGN_TOP;c.addChild(a);a=new pppUI.UISimpleText("punt","puntText",f);a.position={x:2,y:98,width:408,height:27};a.alignMode=pppUI.UISimpleText.ALIGN_CENTER|pppUI.UISimpleText.ALIGN_MIDDLE;c.addChild(a);var e=new pppUI.UITextButton("btn1","respRoundTextButton",pppUI.UIButton.BUTTON,h,true,0);e.position={x:105,y:147,width:202,height:28};e.command=function(i,j){conte.closePopup();gameBegin()};c.addChild(e);e=new pppUI.UITextButton("btn2","respRoundTextButton",pppUI.UIButton.BUTTON,g,true,0);e.position={x:105,y:187,width:202,height:28};e.command=function(i,k){conte.closePopup();var j=new pppUI.UIObject("cover");j.position={x:0,y:0,width:conte.stageWidth,height:conte.stageHeight};conteDoc.addChild(j)};c.addChild(e);return b}function parseMap(g){var f=new gameMap();var e=g.split(";");f.type=parseInt(e.shift());f.points=new Array();var c=3/2*802/950;for(var b=0;b<e.length;b++){var a=e[b].split(",");if(a.length==2){var d={x:parseInt(a[0])*c,y:parseInt(a[1])*c};f.points.push(d)}}return f}function parsePoint(a){var b={x:0,y:0};var c=3/2*802/950;var d=a.split(",");if(d.length==2){b.x=parseInt(d[0])*c;b.y=parseInt(d[1])*c}return b}function stripTags(a){return a.replace(/(<([^>]+)>)/ig,"")}function parseText(a){a=a.replace(/<\/p>/g,"\n");a=stripTags(a);a=a.replace(/\n/g,"<br/>");return a}function loadGame(k,l){theGame=new gameData();theGame.imagePath=k.getAttribute("path")||"";theGame.mode=parseInt(k.getAttribute("mode")||"2");theGame.color=parseInt(k.getAttribute("color")||"204");theGame.layout=parseInt(l.getAttribute("layout")||"1");theGame.pointsVisible=(l.getAttribute("pointsVisible")=="true");theGame.textReplay=l.getAttribute("replayText")||"Volver a jugar";theGame.textNoreplay=l.getAttribute("noreplayText")||"Final de partida";theGame.textTitle=$(l).children("title").text();theGame.textCorrect=$(l).children("correct").text();if(theGame.textCorrect.trim()==""){theGame.textCorrect="Correcto"}theGame.textWrong=$(l).children("wrong").text();if(theGame.textWrong.trim()==""){theGame.textWrong="Incorrecto"}theGame.textFinal=$(l).children("final").text();theGame.textQuestionsTitle=$(l).children("blockTitle").text();theGame.textPuntTitle=$(l).children("pointsText").text();if(theGame.textPuntTitle.trim()==""){theGame.textPuntTitle="Puntuación"}var h=$(k).children("sections")[0];var g=$(h).children("question");theGame.questions=new Array();for(var f=0;f<g.length;f++){var b=g[f];var c=new gameQuestion();c.points=parseInt(b.getAttribute("points")||"5");c.isFilled=(b.getAttribute("isFilled")=="true");c.showDesc=(b.getAttribute("show_description")=="true");c.textDesc=parseText($(b).children("text").text());c.map=parseMap(b.getAttribute("map"));c.mark=parsePoint(b.getAttribute("mark"));var e=$(b).children("answers")[0];var m=$(e).children("answer");c.answers=new Array();for(var d=0;d<m.length;d++){var a=m[d];c.answers.push({text:parseText($(a).text()),correct:(a.getAttribute("correct")=="true")})}theGame.questions.push(c)}}function shuffleArray(d){var c=d.length,b,a;while(0!==c){a=Math.floor(Math.random()*c);c-=1;b=d[c];d[c]=d[a];d[a]=b}return d}var _questions;var _thePreg;var _thePunt;var _puntValue=0;var _pregIntentos=0;var _current;var _theCanvas;var _theMarkers;var _theOkPopup;var _theKoPopup;var _theEndPopup;function gameBegin(){_puntValue=0;_questions=new Array();_theMarkers.removeAllChildren();_questions=theGame.questions.slice(0);shuffleArray(_questions);gameNext()}function gameNext(){_pregIntentos=0;if(_questions.length==0){gameEnd()}else{_current=_questions.shift();if(theGame.mode==1){shuffleArray(_current.answers)}gameSetPreg()}}function gameSetPreg(){var a;if(_thePreg!=null){_thePreg.remove();_thePreg=null}switch(theGame.mode){case 1:_thePreg=createPreguntaWithButtons(theGame.textQuestionsTitle,_current.answers,0);break;case 2:_thePreg=createPregunta(theGame.textQuestionsTitle,_current.answers[0].text,_current.showDesc?_current.textDesc:null);break}if(_thePreg!=null){a=getLayoutPos(theGame.layout,_thePunt,_thePreg);_thePreg.x=a.q.x;_thePreg.y=a.q.y;if(_thePunt.x==0&&_thePunt.y==0){_thePunt.x=a.p.x;_thePunt.y=a.p.y}conteDoc.addChild(_thePreg)}_theCanvas.alpha=0;_theCanvas.setMap(_current.map);if(theGame.mode==1){_theCanvas.fadeIn(500)}else{_theCanvas.onHit=function(c,b){gameRespond(b)}}}function gameRespond(a){var b;if(a==true){_puntValue+=_current.points;var c=_thePunt.getChildById("punt");c.setContent(_puntValue.toString());for(b=0;b<_current.answers.length;b++){if(_current.answers[b].correct==true){createMarker(_theMarkers,_current.answers[b].text,_current.mark,true);break}}conte.openPopup(_theOkPopup);_theOkPopup.onLeave=function(){gameNext()}}else{if(_pregIntentos<2){_pregIntentos++;_theKoPopup.onLeave=null;conte.openPopup(_theKoPopup)}else{for(b=0;b<_current.answers.length;b++){if(_current.answers[b].correct==true){createMarker(_theMarkers,_current.answers[b].text,_current.mark,false);break}}conte.openPopup(_theKoPopup);_theKoPopup.onLeave=function(){gameNext()}}}}function gameEnd(){var a=(_theEndPopup.getChildById("pasti").getChildById("punt"));a.setContent(theGame.textPuntTitle+" "+_puntValue.toString());conte.openPopup(_theEndPopup)}function main(b){var a=true;if(window.hasOwnProperty("pppUIScaled")){a=window.pppUIScaled}conte=new pppUI.UIStage("__stage","diaporama_container",a,false,function(d){conteDoc=d;var g=$(b).children("engine")[0];var c=$(g).children("main")[0];d.setCSSClass("bkWhite");loadGame(g,c);var h=new pppUI.UISimpleText("title","principal_titulo",theGame.textTitle);h.position=MAIN_TITLE_POS;h.alignMode=pppUI.UISimpleText.ALIGN_CENTER|pppUI.UISimpleText.ALIGN_MIDDLE;d.addChild(h);var f=new pppUI.UIImage("image","",pppPreloader.from("data",FUtils.realResourcePath(theGame.imagePath)),pppUI.UIImage.ADJUSTMODE_STRETCH,802,515);f.x=74;f.y=90;d.addChild(f);FUtils.addImageToPreloader("data",FUtils.realResourcePath(theGame.imagePath));_theCanvas=new mapCanvas("canvas");_theCanvas.position={x:f.x,y:f.y,width:802,height:515};d.addChild(_theCanvas);_theMarkers=new pppUI.UIObject("markers");_theMarkers.position={x:f.x,y:f.y,width:802,height:515};_theMarkers.setCSSClass("marker");d.addChild(_theMarkers);_theOkPopup=createPopupResp(true,theGame.textCorrect);_theKoPopup=createPopupResp(false,theGame.textWrong);_theEndPopup=createPopupFinal(theGame.textFinal,"0",theGame.textReplay,theGame.textNoreplay);_thePunt=createPuntuacion(theGame.textPuntTitle,"0");d.addChild(_thePunt);var e=new pppUI.UIObject("watermark");e.addClass("watermark");e.position=WATERMARK_POS;d.addChild(e);if(window.hasOwnProperty("MathJax")){MathJax.Hub.Queue(["Typeset",MathJax.Hub])}FUtils.preloadImages(function(i){pppSpinner.hide();setTimeout(function(){gameBegin()},10)})})};